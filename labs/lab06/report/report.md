---
## Front matter
title: "Лабораторная работа №6"
subtitle: "Адресация IPv4 и IPv6. Двойной стек"
author: "Андреева Софья Владимировна"

## Generic otions
lang: ru-RU
toc-title: "Содержание"

## Bibliography
# bibliography: bib/cite.bib
# csl: pandoc/csl/gost-r-7-0-5-2008-numeric.csl

## Pdf output format
toc: true # Table of contents
toc-depth: 2
lof: true # List of figures
lot: false # List of tables
fontsize: 12pt
linestretch: 1.5
papersize: a4
documentclass: scrreprt
## I18n polyglossia
polyglossia-lang:
  name: russian
  options:
	- spelling=modern
	- babelshorthands=true
polyglossia-otherlangs:
  name: english
## I18n babel
babel-lang: russian
babel-otherlangs: english
## Fonts
mainfont: PT Serif
romanfont: PT Serif
sansfont: PT Sans
monofont: PT Mono
mainfontoptions: Ligatures=TeX
romanfontoptions: Ligatures=TeX
sansfontoptions: Ligatures=TeX,Scale=MatchLowercase
monofontoptions: Scale=MatchLowercase,Scale=0.9
## Biblatex
biblatex: true
biblio-style: "gost-numeric"
biblatexoptions:
  - parentracker=true
  - backend=biber
  - hyperref=auto
  - language=auto
  - autolang=other*
  - citestyle=gost-numeric
## Pandoc-crossref LaTeX customization
figureTitle: "Рис."
tableTitle: "Таблица"
listingTitle: "Листинг"
lofTitle: "Список иллюстраций"
lotTitle: "Список таблиц"
lolTitle: "Листинги"
## Misc options
indent: true
header-includes:
  - \usepackage{indentfirst}
  - \usepackage{float} # keep figures where there are in the text
  - \floatplacement{figure}{H} # keep figures where there are in the text
---

# Цель работы

Целью данной работы является изучение принципов распределения и настройки адресного пространства на
устройствах сети.

# Задание

1. Выполнить задания по разбиению сети на подсети
2. Реализовать в GNS3 топологию сети, настроить IPv4-адресацию на устройствах первой подсети и проверить подключение между устройствами этой подсети, настроить IPv6-адресацию на устройствах второй подсети и проверить подключение между устройствами этой подсети, проанализировать захваченный на соединении сервера двойного стека адресации с коммутатором трафик ARP, ICMP, ICMPv6
3. Охарактеризовать подсети, указать, какие адреса в них входят, предложить вариант таблицы адресации для заданной топологии и адресного пространства, причём для интерфейсов маршрутизатора выбрать наименьший адрес в подсети, настроить IP-адресацию на маршрутизаторе VyOS и оконечных устройствах, причём на интерфейсах маршрутизатора установить наименьший адрес в подсети, проверить подключение между устройствами подсети с помощью команд ping и trace

# Выполнение лабораторной работы

## Разбиение сети на подсети

### Разбиение IPv4-сети на подсети

#### 1) Сеть 172.16.20.0/24

##### А) Характеристики исходной сети:
1. **Префикс**: /24
2. **Маска**: 
   - Двоичный вид: `11111111.11111111.11111111.00000000`
   - Десятичный вид: `255.255.255.0`
3. **Адрес сети**: `172.16.20.0`
4. **Broadcast-адрес**: `172.16.20.255`
5. **Общее число адресов**: 256
6. **Число доступных адресов для хостов**: 254
7. **Диапазон адресов узлов**: `172.16.20.1 — 172.16.20.254`

##### Б) Разбиение на 3 подсети (требования: 126, 62, 62 узлов)
Используем VLSM, начиная с наибольшего требования:

- **Для 126 узлов**: требуется 7 хостовых бит (2⁷ - 2 = 126) , значит префикс /25
- **Для 62 узлов**: требуется 6 хостовых бит (2⁶ - 2 = 62) , значит префикс /26

**Разделение:**
1. **Первый блок (/25)**:
   - Сеть: `172.16.20.0/25`
   - Маска: `255.255.255.128`
   - Broadcast: `172.16.20.127`
   - Диапазон адресов узлов : `172.16.20.1 — 172.16.20.126`

2. **Второй блок (/26)**:
   - Сеть: `172.16.20.128/26`
   - Маска: `255.255.255.192`
   - Broadcast: `172.16.20.191`
   - Диапазон адресов узлов: `172.16.20.129 — 172.16.20.190`

3. **Третий блок (/26)**:
   - Сеть: `172.16.20.192/26`
   - Маска: `255.255.255.192`
   - Broadcast: `172.16.20.255`
   - Диапазон адресов узлов: `172.16.20.193 — 172.16.20.254`

#### 2) Сеть 10.10.1.64/26

##### А) Характеристики:
1. **Префикс**: /26
2. **Маска**: `255.255.255.192`
3. **Адрес сети**: `10.10.1.64`
4. **Broadcast**: `10.10.1.127`
5. **Общее число адресов**: 64
6. **Доступных для хостов**: 62
7. **Диапазон узлов**: `10.10.1.65 — 10.10.1.126`

##### Б) Выделение подсети на 30 узлов
- Требуется 5 хостовых бит (2⁵ - 2 = 30) , значит префикс /27
- Выделенная подсеть: `10.10.1.64/27`
- Маска: `255.255.255.224`
- Broadcast: `10.10.1.95`
- Диапазон адресов узлов: `10.10.1.65 — 10.10.1.94`

## 3) Сеть 10.10.1.0/26

### А) Характеристики:
1. **Префикс**: /26
2. **Маска**: `255.255.255.192`
3. **Адрес сети**: `10.10.1.0`
4. **Broadcast**: `10.10.1.63`
5. **Общее число адресов**: 64
6. **Доступных для хостов**: 62
7. **Диапазон узлов**: `10.10.1.1 — 10.10.1.62`

### Б) Выделение подсети на 14 узлов
- Требуется 4 хостовых бит (2⁴ - 2 = 14) , значит префикс /28
- Выделенная подсеть: `10.10.1.0/28`
- Маска: `255.255.255.240`
- Broadcast: `10.10.1.15`
- Диапазон адресов узлов: `10.10.1.1 — 10.10.1.14`

### Разбиение IPv6-сети на подсети

#### 1) Сеть 2001:db8:c0de::/48

##### А) Характеристики:
1. **Префикс**: /48
2. **Маска**: `ffff:ffff:ffff:0000:0000:0000:0000:0000`
3. **Структура**:
   - Биты 0-47: глобальный префикс `2001:0db8:c0de`
   - Биты 48-63: идентификатор подсети
   - Биты 64-127: идентификатор интерфейса
4. **Диапазон адресов**:
   - Минимальный: `2001:db8:c0de:0000:0000:0000:0000:0000`
   - Максимальный: `2001:db8:c0de:ffff:ffff:ffff:ffff:ffff`
5. **Число адресов**: 2⁸⁰

##### Б) Разбиение на 2 подсети
**С использованием идентификатора подсети**

Берём 1 бит из 16-битного Subnet ID, увеличиваем префикс с /48 до /49. Это даёт 2 подсети, каждая размером /49.

- **Подсеть 0**: `2001:db8:c0de:0000::/49`
  - Диапазон: `2001:db8:c0de:0000:0000:0000:0000:0000 — 2001:db8:c0de:7fff:ffff:ffff:ffff:ffff`
- **Подсеть 1**: `2001:db8:c0de:8000::/49`
  - Диапазон: `2001:db8:c0de:8000:0000:0000:0000:0000 — 2001:db8:c0de:ffff:ffff:ffff:ffff:ffff`

**Использование идентификатора интерфейса**

При данном подходе мы берём 1 бит не из Subnet ID, а из Interface ID (последних 64 бит). 

**Механизм разделения:**
- Оставляем SubnetID на фиксированном значении (например 0)
- Делим пространство адресов по старшему биту интерфейсного поля
- Увеличиваем префикс от /48 до /65
  - *Расчёт:* 48 + 17 = 65 (16 бит из Subnet ID + 1 бит из IID)

**Созданные подсети:**

**Подсеть A:** `2001:db8:c0de:0::/65`
- **Диапазон:** от `2001:db8:c0de:0000:0000:0000:0000:0000` до `2001:db8:c0de:0000:7fff:ffff:ffff:ffff`
- **Условие:** IID старший бит = 0

**Подсеть B:** `2001:db8:c0de:0:8000::/65`
- **Диапазон:** от `2001:db8:c0de:0000:8000:0000:0000:0000` до `2001:db8:c0de:0000:ffff:ffff:ffff:ffff`
- **Условие:** IID старший бит = 1

Такой подход является **нестандартным**!  
Обычно интерфейсный идентификатор — это область размером 64 бита, которую не рекомендуется изменять. Использование префиксов длиннее /64 для реальных LAN приводит к проблемам с:
- SLAAC 
- Некорректной работой сетевых реализаций
- Нарушением стандартов RFC


#### 2) Сеть 2a02:6b8::/64

##### А) Характеристики:
1. **Префикс**: /64
2. **Маска**: `ffff:ffff:ffff:ffff:0000:0000:0000:0000`
3. **Диапазон адресов**:
   - Минимальный: `2a02:06b8:0000:0000:0000:0000:0000:0000`
   - Максимальный: `2a02:06b8:0000:0000:ffff:ffff:ffff:ffff`
4. **Число адресов**: 2⁶⁴

##### Б) Разбиение на 2 подсети

**Разбиение на 2 подсети с использованием идентификатора подсети:**

При префиксе /64 под подсети уже не отведено битов, так как первые 64 бита — это префикс сети. Поэтому для деления нам придется нарушить стандарт и заимствовать биты из идентификатора интерфейса. 

**С использованием идентификатора интерфейса** (префикс /65):
- **Подсеть 1**: `2a02:6b8::/65`
  - Диапазон: `2a02:6b8:: — 2a02:6b8::7fff:ffff:ffff:ffff`
- **Подсеть 2**: `2a02:6b8::8000:0:0:0/65`
  - Диапазон: `2a02:6b8::8000:0:0:0 — 2a02:6b8::ffff:ffff:ffff:ffff`

## Настройка двойного стека адресации IPv4 и IPv6 в локальной сети

Запустили GNS3 VM и GNS3. Создали новый проект.

![Создание нового проекта в GNS3 ](image/1.png){#fig-001 width=70%}

В рабочем пространстве разместили и соединили устройства в соответствии с топологией, приведённой в лабораторной работе. Для подсети IPv4 использовали маршрутизатор FRR, а для подсети с IPv6 — маршрутизатор VyOS.  Коммутаторам присвойте названия по принципу msk-svandreeva -sw-0x, маршрутизаторам — по принципу msk-svandreeva -gw-0x, VPCS — по принципу PCx-svandreeva , где x — порядковый номер устройства 

![Топология сети с двумя локальными подсетями](image/2.png){#fig-002 width=70%}

Включили захват трафика на соединении между сервером двойного стека адресации и ближайшим к нему коммутатором 

![Захват трафика на соединении между сервером двойного стека адресации и ближайшим к нему коммутатором](image/3.png){#fig-003 width=70%}

Руководствуясь (табл. 3.6), настроили IPv4-адресацию для интерфейсов узлов PC1, PC2, Server:

- PC1 :

```
ip 172.16.20.10/25 172.16.20.1

```

![Настройка IP-адреса на PC1](image/4.png){#fig-004 width=70%}

- PC2:

```
ip 172.16.20.138/25 172.16.20.129

```

![Настройка IP-адреса на PC2](image/5.png){#fig-005 width=70%}

- Server:

```
ip 64.100.1.10/24 64.100.1.1
save
```

![Настройка IP-адреса на Server](image/6.png){#fig-006 width=70%}

Посмотрели на PC1 и PC2 конфигурацию IPv4 и IPv6:

```
show ip
show ipv6
```

![Конфигурация IPv4 и IPv6](image/7.png){#fig-007 width=70%}

Руководствуясь (табл. 3.6), настроили IPv4-адресацию для интерфейсов локальной сети маршрутизатора FRR msk-svandreeva -gw-01 :

![Настройка IP-адреса на маршрутизаторе FRR](image/8.png){#fig-008 width=70%}

Проверили конфигурацию маршрутизатора и настройки IPv4-адресации:

```
msk-svandreeva -gw-01# show running-config
msk-svandreeva -gw-01# show interface brief
```

![Проверка конфигурации маршрутизатора FRR, настройки IPv4-адресации на маршрутизаторе FRR](image/9.png){#fig-009 width=70%}


Далее проверили подключение с помощью команд ping и trace. Узлы PC1 и PC2 успешно отправляют эхо-запросы друг другу и на сервер с двойным стеком (Dual Stack Server) 

![Отправка эхо-запросов между PC1 и PC2 и Server с помощью ping и trace](image/10.png){#fig-010 width=70%}

Руководствуясь (табл. 3.6), настроили IPv6-адресацию для интерфейсов узлов PC3, PC4, Server:

- PC3:

```
ip 2001:db8:c0de:12::a/64
save
```

![Настройка IP-адреса на PC3](image/11.png){#fig-011 width=70%}

- PC4 :

```
ip 2001:db8:c0de:13::a/64
save
```

![Настройка IP-адреса на PC4](image/12.png){#fig-012 width=70%}

- Server:

```
ip 2001:db8:c0de:11::a/64
save
```

![Настройка IP-адреса на Server](image/13.png){#fig-013 width=70%}

Посмотрели на PC3 и PC4 конфигурацию IPv4 и IPv6 :

```
show ip
show ipv6
```

![Конфигурация IPv4 и IPv6 на PC3](image/14.png){#fig-014 width=70%}


Руководствуясь (табл. 3.6), настроили IPv6-адресацию для интерфейсов локальной сети маршрутизатора VyOS msk-svandreeva -gw-02:

- Перешли в режим конфигурирования, изменили имя устройства:

```
vyos@vyos$ configure
vyos@vyos# set system host-name msk-svandreeva -gw-02
vyos@vyos# compare
vyos@vyos# commit
vyos@vyos# save
vyos@vyos# exit
vyos@vyos$ reboot
```

![Настройка имени устройства ](image/15.png){#fig-015 width=70%}

- Назначили IPv6-адреса маршрутизатору msk-svandreeva -gw-02 :

![Настройка на маршрутизаторе VyOS ](image/16.png){#fig-016 width=70%}

![Сохранение и Проверка настроек IPv6-адресации на маршрутизаторе VyOS](image/17.png){#fig-017 width=70%}

Проверили подключение с помощью команд ping и trace. Узлы PC3 и PC4 успешно отправляют эхо-запросы друг другу и на сервер с двойным стеком (Dual Stack Server) 

![Отправка эхо-запросов  PC3, PC4 и Server с помощью ping и trace](image/18.png){#fig-018 width=70%}

Убедились, что устройства из подсети IPv4 не доступны для устройств из подсети IPv6 и наоборот. Только сервер двойного стека может обращаться к устройствам обеих подсетей 

![Попытка подключения  PC3, PC4 к PC1, PC2](image/19.png){#fig-019 width=70%}

![Попытка подключения PC1 к PC3](image/20.png){#fig-020 width=70%}


Далее посмотрели захваченный на соединении сервера двойного стека адресации с коммутатором трафик ARP, ICMP, ICMPv6. Сеть работоспособна - есть двусторонняя связь, оба стека (IPv4/IPv6) активны, базовые протоколы работают корректно ([рис. @fig-032])

![Перехваченные пакеты ICMPv6](image/21.png){#fig-021 width=70%}

![Перехваченные пакеты ICMP](image/22.png){#fig-022 width=70%}

![Перехваченные пакеты ARP](image/23.png){#fig-023 width=70%}

## Задание для самостоятельного выполнения

Создали новый проект.Задали топологию сети 

![Топология сети с двумя локальными подсетями ](image/24.png){#fig-024 width=70%}

Предполагается, что маршрутизатор разбивает сеть на две подсети с адресами IPv4 и IPv6:

- подсеть 1: 10.10.1.96/27; 2001:DB8:1:1::/64;
- подсеть 2: 10.10.1.16/28; 2001:DB8:1:4::/64.

Охарактеризовали подсети, укажем, какие адреса в них входят.
Вычисления broadcast-адреса для 1 подсети:

- Маска: 11111111.11111111.11111111.11100000 (255.255.255.224)
- Инвертированная маска: 00000000.00000000.00000000.00011111 (0.0.0.31)
- Применим инвертированную маску к сети: 10.10.1.96 (сетевая часть) OR  0.0.0.31 (инвертированная маска) = **10.10.1.127**

Вычисления broadcast-адреса для 2 подсети:

- Маска: 11111111.11111111.11111111.11110000 (255.255.255.240)
- Инвертированная маска: 00000000.00000000.00000000.00001111 (0.0.0.15)
- Применим инвертированную маску к сети: 10.10.1.16 (сетевая часть) OR  0.0.0.15 (инвертированная маска) = **10.10.1.31**

Предложили вариант таблицы адресации для заданной топологии и адресного пространства

![Таблица](image/25.png){#fig-025 width=70%}

Задали IP-адреса для PC1

![Настройка IP-адреса на PC1-svandreeva ](image/26.png){#fig-026 width=70%}

Задали IP-адреса для PC2 

![Настройка IP-адреса на PC2-svandreeva ](image/27.png){#fig-027 width=70%}

Назначили IPv6 и IPv4-адреса интерфейсам маршрутизатора msk-svandreeva -gw-01 :

```
vyos@msk-svandreeva -gw-01:~$ configure
vyos@msk-svandreeva -gw-01:~$ delete interfaces ethernet eth0 address dhcp
vyos@msk-svandreeva -gw-01:~$ delete interfaces ethernet eth0 address 10.10.1.97/27
vyos@msk-svandreeva -gw-01:~$ delete interfaces ethernet eth1 address 10.10.1.17/28
vyos@msk-svandreeva -gw-01# set interfaces ethernet eth0 address 2001:db8:1:1::1/64
vyos@msk-svandreeva -gw-01# set service router-advert interface eth0 prefix 2001:db8:1:1::/64
vyos@msk-svandreeva -gw-01# set interfaces ethernet eth1 address 2001:db8:1:4::1/64
vyos@msk-svandreeva -gw-01# set service router-advert interface eth1 prefix 2001:db8:1:4::/64
```

![Настройка на маршрутизаторе VyOS ](image/28.png){#fig-028 width=70%}

![ПНастройка на маршрутизаторе VyOS](image/29.png){#fig-029 width=70%}

![Настройка на маршрутизаторе VyOS](image/30.png){#fig-030 width=70%}

![Настройка на маршрутизаторе VyOS](image/31.png){#fig-031 width=70%}

Проверили подключение между устройствами подсети с помощью команд ping и trace 

![Отправка эхо-запроса PC1 и PC2](image/32.png){#fig-032 width=70%}

# Выводы

В ходе выполнения лабораторной работы №6 мы изучили принципы распределения и настройки адресного пространства на устройствах сети.
